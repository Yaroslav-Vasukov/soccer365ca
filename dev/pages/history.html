{% extends "../layouts/_base.html" %}

{# Получаем slug лиги из URL параметров или используем значение по умолчанию #}
{% set league_slug = get_url_param('league', 'premier-league') %}

{# Загружаем данные для нужной лиги #}
{% set historyData = load_json('@/data/history/' ~ league_slug ~ '.json') %}

{# Если данные не найдены, используем заглушку #}
{% if not historyData or not historyData.league %}
  {% set historyData = {
    league: { name: "League Not Found", founded: "N/A", country: "Unknown" },
    introduction: { 
      title: "League History Not Available", 
      subtitle: "Coming Soon",
      description: ["The history for this league is not yet available. Please check back later."]
    },
    timeline: [],
    achievements: []
  } %}
{% endif %}

{# Получаем данные из JSON #}
{% set league = historyData.league %}
{% set intro = historyData.introduction %}
{% set timeline = historyData.timeline %}
{% set achievements = historyData.achievements %}

{% block title %}{{ league.name }} - История{% endblock %}
{% block active_nav %}history{% endblock %}
{% block body_class %}page page--history{% endblock %}

{% block content %}
{% include "../components/page-head/page-head.twig" with {
  title: intro.title,
  subtitle: intro.subtitle,
  breadcrumbs: [
    { label: "Главная", href: "/", home: true },
    { label: "Лиги", href: "/leagues" },
    { label: league.name, href: "/league/" ~ league_slug },
    { label: "history" }
  ],
} only %}

<!-- Введение с логотипом лиги -->
<section class="section section--margin">
  <div class="container">
    <div class="section__inner">
      <div class="history-intro">
        <div class="history-intro__content">
          <div class="history-intro__league">
            <div class="history-intro__league-info">
              <h2 class="history-intro__league-name">{{ league.name }}</h2>
              <p class="history-intro__league-details">
                {{ league.country }} • Founded in {{ league.founded }}
              </p>
            </div>
          </div>
          
          {% for paragraph in intro.description %}
          <p class="history-intro__text">{{ paragraph }}</p>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Временная шкала -->
{% if timeline and timeline|length > 0 %}
<section class="section section--margin section--decor">
  <img src="/assets/images/bg/bg1.webp" alt="" class="section__bg" />
  <div class="container">
    <div class="section__inner">
      {% include "../components/section-header/section-header.twig" with {
        title: "История " ~ league.name
      } %}
      
      <div class="timeline">
        {% for item in timeline %}
        <div class="timeline__item{% if item.current %} timeline__item--current{% endif %}">
          <div class="timeline__marker">
            <span class="timeline__year">{{ item.year }}</span>
          </div>
          <div class="timeline__content">
            <h3 class="timeline__title">{{ item.title }}</h3>
            <p class="timeline__text">{{ item.description }}</p>
            
            {% if item.stats %}
            <div class="timeline__stats">
              {% for stat in item.stats %}
              <div class="timeline__stat">
                <span class="timeline__stat-number">{{ stat.number }}</span>
                <span class="timeline__stat-label">{{ stat.label }}</span>
              </div>
              {% endfor %}
            </div>
            {% endif %}
            
            {% if item.highlights %}
            <div class="timeline__highlights">
              {% for highlight in item.highlights %}
              <div class="timeline__highlight">
                <span class="material-symbols-outlined">{{ highlight.icon }}</span>
                <span>{{ highlight.text }}</span>
              </div>
              {% endfor %}
            </div>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</section>
{% endif %}

<!-- Достижения -->
{% if achievements and achievements|length > 0 %}
<section class="section section--margin">
  <div class="container">
    <div class="section__inner">
      {% include "../components/section-header/section-header.twig" with {
        title: "Главные достижения"
      } %}
      
      <div class="achievements">
        <div class="achievements__grid">
          {% for achievement in achievements %}
          <div class="achievement">
            <div class="achievement__icon">
              <span class="material-symbols-outlined">{{ achievement.icon }}</span>
            </div>
            <div class="achievement__content">
              <h3 class="achievement__title">{{ achievement.title }}</h3>
              <p class="achievement__text">{{ achievement.description }}</p>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</section>
{% endif %}

{% endblock %}

{% block scripts %}
<script>
// Получаем параметр лиги из URL для клиентского JavaScript
const getCurrentLeague = () => {
  const path = window.location.pathname;
  const match = path.match(/\/league\/([^\/]+)\/history/);
  return match ? match[1] : 'premier-league';
};

// Можно использовать для дополнительной логики
console.log('Current league:', getCurrentLeague());
</script>
{% endblock %}